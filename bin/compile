#!/bin/bash
# Usage: bin/compile BUILD_DIR CACHE_DIR ENV_DIR

set -e
set -o pipefail

BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

EMACS_PACKAGE_URL=https://github.com/kosh04/heroku-buildpack-emacs/releases/download/v1.0-beta/emacs-24.5-heroku-bin.tar.xz

indent() {
  sed -u 's/^/       /'
}

echo "-----> Install Emacs" | indent

mkdir -p $BUILD_DIR/.heroku/vendor
curl -fsSL $EMACS_PACKAGE_URL | tar xJ -C $BUILD_DIR/.heroku/vendor

echo "-----> Install Cask" | indent

curl -fsSL https://raw.githubusercontent.com/cask/cask/master/go | python
export PATH=$PATH:$PWD/.cask/bin
cask install | indent

echo "...done" | indent
